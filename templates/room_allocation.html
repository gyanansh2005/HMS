<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Room Allocation</title>
    <link rel="shortcut icon" href="../static/favicon.png" type="image/x-icon">
    <link rel="stylesheet" href="../static/css/room_allocation.css">
    <style>
    </style>
</head>
<body>
    {%extends 'base.html'%}
    {%block content%}
    <br><br><br>
    <div class="container">
        <h2>Room Allocation</h2>

        <form class="allocation-form">
            <label for="hostel">Select Hostel:</label>
            <select id="hostel" name="hostel">
                <option value="hostel-1">Hostel 1</option>
                <option value="hostel-2">Hostel 2</option>
                <option value="hostel-3">Hostel 3</option>
                <option value="hostel-4">Hostel 4</option>
                <option value="hostel-5">Hostel 5</option>
                <option value="hostel-6">Hostel 6</option>
            </select>

            <label for="floor">Select Floor:</label>
            <select id="floor" name="floor">
                <option value="1">Floor 1</option>
                <option value="2">Floor 2</option>
                <option value="3">Floor 3</option>
                <option value="4">Floor 4</option>
                <option value="5">Floor 5</option>
            </select>

            <label for="room-type">Select Room Sharing:</label>
            <select id="room-type" name="room-type" onchange="updateRoomNumbers()">
                <option value="four">4 Sharing</option>
                <option value="single">Single Seater</option>
                <option value="double">Double Sharing</option>
            </select>

            <!-- <label for="ac">AC/Non-AC:</label>
            <select id="ac" name="ac">
                <option value="ac">AC</option>
                <option value="non-ac">Non-AC</option>
            </select> -->
            <label for="room-number">Select Room Number:</label>
            <select id="room-number" name="room-number" required>
                <option value="">Select Room</option>
            </select>
            
            <label for="student-name">Student Name:</label>
            <input type="text" id="student-name" name="student-name" required>

            <button type="submit">Allocate Room</button>
        </form>

        <div class="room-status">
            <h3>4 Sharing Room Availability</h3>
            <div class="room-grid" id="four-sharing-grid"></div>
            <h3>Double Sharing Room Availability</h3>
            <div class="room-grid" id="double-sharing-grid"></div>
            <h3>Single Seater Room Availability</h3>
            <div class="room-grid" id="single-seater-grid"></div>
        </div>
    </div>
    
    <script>
        const roomAvailability = {
            'four': [],
            'double': [],
            'single': []
        };
    
        function generateRoomStatus(gridId, maxBeds, roomType) {
            const roomGrid = document.getElementById(gridId);
            roomGrid.innerHTML = '';
            roomAvailability[roomType] = []; // Reset available rooms for the type
            
            for (let i = 1; i <= 10; i++) {
                let roomDiv = document.createElement('div');
                roomDiv.classList.add('room');
                let bedsLeft = Math.floor(Math.random() * (maxBeds + 1));
                roomDiv.textContent = `Room ${i} (Beds Left: ${bedsLeft})`;
                roomDiv.classList.add(bedsLeft > 0 ? 'available' : 'booked');
                roomGrid.appendChild(roomDiv);
                
                // Update room availability based on beds left
                if (bedsLeft > 0) {
                    roomAvailability[roomType].push(i);
                }
            }
        }
    
        function getRoomType() {
            return document.getElementById('room-type').value;
        }
    
        function updateRoomNumbers() {
            const roomType = getRoomType();
            const roomNumberSelect = document.getElementById('room-number');
            roomNumberSelect.innerHTML = '<option value="">Select Room</option>'; // Reset options
    
            roomAvailability[roomType].forEach(roomNumber => {
                const option = document.createElement('option');
                option.value = roomNumber;
                option.textContent = `Room ${roomNumber}`;
                roomNumberSelect.appendChild(option);
            });
    
            // Ensure room grids update first before applying blur effect
            setTimeout(() => {
                document.getElementById('four-sharing-grid').classList.toggle('blurred', roomType !== 'four');
                document.getElementById('double-sharing-grid').classList.toggle('blurred', roomType !== 'double');
                document.getElementById('single-seater-grid').classList.toggle('blurred', roomType !== 'single');
            }, 50);
        }
    
        function updateRooms() {
            generateRoomStatus('four-sharing-grid', 4, 'four');
            generateRoomStatus('double-sharing-grid', 2, 'double');
            generateRoomStatus('single-seater-grid', 1, 'single');
        }
    
        document.getElementById('hostel').addEventListener('change', updateRooms);
        document.getElementById('floor').addEventListener('change', updateRooms);
        document.getElementById('room-type').addEventListener('change', function () {
            updateRoomNumbers();
        });
    
        updateRooms();
        updateRoomNumbers();
    </script>
    
    
    {%endblock%}
</body>
</html>